## Text-to-speech
### 功能：
*输入一段文字，转换成mp3文件格式，输出URL，供其他服务调用*

- 输入
    * Base64编码

- 输出
    * MP3 网络路径

- 验证机制
    * 域名授权
    * 其他方式待定

### 原理：
- 浏览器端
    1. 页面初始化后遍历所有span标签Class属性为data_tts的文本，进行Base64编码后，形成数组。
    2. 在用GET请求方式，遍历数组以5条为一组发送给语音服务器。每条不得超过100汉字。
    3. 获得返回mp3的URL数组，以key-value的方式保存在浏览器端隐藏域中。
        * key:文本base64编码。
        * value:mp3 url路径。
    4. 朗读时根据当前文本的base64编码，请求value朗读语音。
    5. 考虑到如果多用户访问延迟的问题。可以在进入页面时做一个DIV透明遮蔽层提示语音转换中并显示进度条。前台的请求方式可以精确的获得到返回状态。在去除遮蔽层。

- 服务端：
    1. 接收来自浏览器的请求。把Base64编码解码后，生成纯文本。
    2. 把纯文本进行md5后做为所引保存到数据库。数据库格式为：
        * md5(检索使用)
        * 纯文本(朗读的文本)
        * 创建时间(用来作为周期删除的依据）
        * 使用率(每次初始化请求转换的文本如果以转换过进行自增)
        * 状态(和转换器协作使用为别为：等待转换，正在转换，转换完成，上传完成)
    3. 转换过的语音短期不会在转换。但会根据使用率，进行周期性删除。删除后需要重新进行转换。
    4. 以上方式主要以保存实际使用率相对较多的语音为主。以确保最少的存储空间支持较多的网站。
- 转换器:
    1. 转换器是独立出来的一个应用程序。主要负责从数据库里取出等待转换数据进行转换。完成后上传。
    2. 转换器需在命令行情况下运行。t2m [数据库IP端口] [转换后保存的路径] [线程数]
    3. 目前上传功能没有完成。也可独立开发上传器。
    4. 目前默认开起15个线程。满负荷CPU最高使用率在93%-97%。
    5. 单个线程的转换时间数据100汉字850毫秒左右。。
    5. 后期可扩展为。检测CPU的使用率。来自动减少和增加线程数。
