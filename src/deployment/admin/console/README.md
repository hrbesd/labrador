# Admin Console Spec

*草稿*

*不保证与实现功能同步*

## 目的

结合功能模块，实现Feature Spec中关于服务运营的部分要求。

## 功能与用法

### 创建网站

#### 子命令

`create`

#### 输入

- `ID` 必需参数，字符串，如`harbin`
- `Host` 必需参数，字符串， 如`www.harbin.gov.cn`

#### 行为

- 为新网站生成文档
- 根据输入参数更新网站配置文件
- 根据输入参数更新DNS记录
- 修改Web Server配置文件，为网站开启二级域名

#### 示例

```
lab create harbin www.harbin.gov.cn
```

### 显示统计信息

#### 子命令

`info`

#### 输入

- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 行为

针对当前网站，给出如下统计信息：

- 是否自动更新
- 文件大小
- 目录个数
- 文件个数
- 上次更新时间

#### 示例

在网站目录下：

```
lab info
```

### 暂停/恢复更新

#### 子命令

`pause` `resume`

#### 输入

- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 行为

- 暂停/恢复当前网站更新

#### 示例

```
lab pause harbin
```
在网站目录下：

```
lab resume
```

### 重置网站

#### 子命令

`reset`

#### 输入

- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 行为

- 重置网站的所有规则、缓存和网页
- 只保留配置信息

#### 示例

```
lab reset harbin
```

### 启动/停止全部网站更新

#### 子命令

`start` `stop`

#### 输入

不需要参数。

#### 行为

- 为**当前用户**的`cron`安装/删除调度器

#### 示例

```
lab stop
```

### 备份/恢复网站

#### 子命令

`backup` `restore`

#### 输入

- `ID` 网站目录之内可以省略，字符串，如`harbin`
- `Dir` 备份必需参数，路径，备份到此目录
- `Archive` 恢复必需参数，路径，从这个备份包恢复

#### 行为

- 将网站下的所有配置、规则和网页打包储存
- 将备份内容恢复到当前网站

#### 示例

```
lab backup <Dir>
```

```
lab restore harbin <Archive>
```

### 手动更新网站

#### 子命令

`update`

#### 输入

- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 行为

- 运行调度器，依次执行各个功能模块


#### 示例

```
lab update
```

### 查看日志

#### 子命令

`log`

#### 输入

- `--console` 查看控制台的日志
- `--scheduler` `--daemon` 查看自动更新的日志
- 网站 ID

#### 行为

- 查看某个系统模块或网站的日志
- 无参数时查看所有系统日志的最近20条日志
- 使用网站名做参数时查看网站所有模块的最近20条日志

#### 示例

```
lab log --console
```

```
lab log harbin
```

### 编辑网站配置

#### 子命令

```
config
```

#### 输入

- `--global` 编辑全局配置
- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 显示网站列表

#### 子命令

```
list
```

### （开发者）运行单独功能模块

#### 子命令

`run …` `run … for …`

#### 输入

- `module` 功能模块名称，如：`spider`
- `ID` 网站目录之内可以省略，字符串，如`harbin`

#### 行为

- 为当前网站单独运行指定的功能模块
- 在网站自动更新时运行单独功能模块可能有无法预知的结果

#### 示例

```
lab run spider for harbin
```

```
lab run reactor
```

## 技术实现

### 语言

主要用Shell脚本语言实现。

### 架构

- `lab.sh` 为命令入口，根据子命令执行对应的脚本
- 子命令在`./console/commands/`目录里单独实现
- 辅助功能在`./console/utils/`里实现
- 在路径中建立为`lab.sh`建立Symbol Link，主命令简化用`lab`执行

## 已知问题

- 部分功能没有实现